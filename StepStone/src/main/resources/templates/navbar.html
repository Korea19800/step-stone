<!doctype html>
<html lang="ko"
      xmlns:th="http://thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- JavaScript Bundle with Popper -->
<!-- 헤더 navbar -->
<nav th:fragment="navbarFragment" class="navbar navbar-expand-lg" style="background-color: #F3F6FA;">
    <div class="container-fluid">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
        <!-- 로고 부분 -->
        <a class="navbar-brand px-3" href="/">
            <img src="/stepstone_icon.png" width="55" height="55"/>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 기본 메뉴들 부분 -->
        <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
            <ul class="navbar-nav">
                <li class="nav-item px-4">
                    <a class="nav-link" th:href="@{/post/list?page=0}"><strong>게시글 목록</strong></a>
                </li>
                <li class="nav-item px-4">
                    <a class="nav-link" th:href="@{/workspace/list?page=0}"><strong>워크스페이스</strong></a>
                </li>
                <li class="nav-item px-4">
                    <a class="nav-link" th:href="@{/project/list?page=0}"><strong>완성된 프로젝트</strong></a>
                </li>
                <li class="nav-item px-4">
                    <a class="nav-link" th:href="@{|/chat/room|}"><strong>채팅방 바로가기</strong></a>
                </li>
                <li class="nav-item px-4">
                    <a class="nav-link" th:href="@{|/mypage|}"><strong>마이페이지</strong></a>
                </li>
            </ul>
        </div>

        <!-- 알림 아이콘 부분 -->
        <div class="justify-content-center">
            <ul class="navbar-nav">
                <!--                <li class="nav-item">-->
                <!--                    <a class="nav-link" href="">-->
                <!--                        <i class="fa-solid fa-bell"></i>-->
                <!--                    </a>-->
                <!--                </li>-->
                <li class="nav-item" sec:authorize="isAuthenticated()">

                    <i th:if="${!hasNotification}" class="fa fa-bell-o" aria-hidden="true" type="submit"></i>
                    <div class="dropdown-center" id="dropdown">

                        <a th:if="${hasNotification}" class="text-info fa fa-bell dropdown-toggle"
                           data-bs-toggle="dropdown" aria-expanded="false" aria-hidden="true"></a>
                        <ul class="dropdown-menu" id="dropdown-menu">
                            <li th:each="notification : ${notifications}">
                                <div class="container-fluid" th:id="'notificationList' + ${notification.id}">
                                    <form action="/notification/mark" name="markForm" method="POST"></form>
                                    <div class="row gx-1">
                                        <a class="ms-1 col"
                                           th:onclick="'javascript:postMark(event, \'' + ${notification.id} + '\');'"
                                           id="notificationTitle" th:text="${notification.title}"
                                           style="font-size : 12px; text-decoration:none; color : black;"
                                           data-bs-toggle="collapse"
                                           th:href="'#collapse' + ${notification.id}" aria-expanded="false"
                                           th:attr="aria-controls='#collapse' + ${notification.id}">Action
                                        </a>
                                        <span class="text-end col">
                                            <svg th:onclick="'javascript:dropli(\'' + ${notification.id} + '\');'" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                            </svg>
                                        </span>
                                    </div>

                                    <!--                                   th:attr="data-bs-target='#collapse' + ${notification.id}"-->
                                    <div class="collapse ms-1 mt-1" th:id="'collapse' + ${notification.id}">

                                        <div style="font-size : 10px" th:text="${notification.message}">
                                            Lorem ipsum dolor text....
                                        </div>
                                    </div>
                                </div>

                            </li>

                            <div class="text-center"><button onclick="postMarkAll()" type="button" class="btn btn-secondary" style="font-size:12px;">알림 모두 지우기</button></div>
                        </ul>

                    </div>
                </li>
            </ul>
        </div>

        <!-- 로그인, 회원가입 부분 -->
        <div class="d-flex flex-row justify-content-around px-3">
            <ul class="navbar-nav gap-2">
                <li class="nav-item px-2">
                    <!-- sec:authorize="isAnonymous()" : 로그아웃 상태일 때 만 렌더링 -->
                    <a class="nav-link" sec:authorize="isAnonymous()" th:href="@{/login}">로그인</a>
                    <!--sec:authorize="isAuthenticated()" : 로그인 상태일 때 만 렌더링 -->
                    <a class="nav-link" sec:authorize="isAuthenticated()" th:href="@{/logout}">로그아웃</a>
                </li>
                <li class="nav-item">
                    <a role="button" sec:authorize="isAnonymous()" th:href="@{/join}" class="btn"
                       style="background-color: #3C64B1; color: #dddddd">회원가입</a>
                </li>
            </ul>
        </div>

    </div>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script th:inline="javascript">
        function stopProp(event) {
            event.stopPropagation();
        }

        let textarea = document.getElementById('dropdown-menu');
        // 이벤트 리스너가 catch 한 이벤트를 submitTextarea 에 넘겨줍니다.
        textarea.addEventListener('click', event => stopProp(event));

        function postMark(event, id) {
            console.log("mark");
            // name이 paging인 태그
            event.preventDefault();
            $.post("/notification/mark", {id: id});
            return false;
        }

        function dropli(id){
            $("#notificationList" + id).empty();
            $.post("/notification/mark", {id: id});
        }
        function postMarkAll(){
            console.log("mark");
            // name이 paging인 태그
            // event.preventDefault();
            $("#dropdown-menu").empty();
            $.post("/notification/mark/all");

            str = "<div class=\"text-center\"><button onclick=\"postMarkAll()\" type=\"button\" class=\"btn btn-secondary\" style=\"font-size:12px;\">알림 모두 지우기</button></div>";
            $("#dropdown-menu").append(str);
            return false;
        }



    </script>
</nav>

</html>
